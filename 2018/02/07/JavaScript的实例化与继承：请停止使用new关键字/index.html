<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="javascript," />










<meta name="description" content="JavaScript中的new关键字可以实现实例化和继承的工作，但个人认为使用new关键字并非是最佳的实践，还可以有更友好一些的实现。本文将介绍使用new关键字有什么问题，然后介绍如何对与new相关联的一系列面向对象操作进行封装，以便提供更快捷的、更易让人理解的实现方式。">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript的实例化与继承：请停止使用new关键字">
<meta property="og:url" content="http://yoursite.com/2018/02/07/JavaScript的实例化与继承：请停止使用new关键字/index.html">
<meta property="og:site_name" content="supermanbin">
<meta property="og:description" content="JavaScript中的new关键字可以实现实例化和继承的工作，但个人认为使用new关键字并非是最佳的实践，还可以有更友好一些的实现。本文将介绍使用new关键字有什么问题，然后介绍如何对与new相关联的一系列面向对象操作进行封装，以便提供更快捷的、更易让人理解的实现方式。">
<meta property="og:updated_time" content="2018-02-07T07:48:39.360Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript的实例化与继承：请停止使用new关键字">
<meta name="twitter:description" content="JavaScript中的new关键字可以实现实例化和继承的工作，但个人认为使用new关键字并非是最佳的实践，还可以有更友好一些的实现。本文将介绍使用new关键字有什么问题，然后介绍如何对与new相关联的一系列面向对象操作进行封装，以便提供更快捷的、更易让人理解的实现方式。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/02/07/JavaScript的实例化与继承：请停止使用new关键字/"/>





  <title>JavaScript的实例化与继承：请停止使用new关键字 | supermanbin</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">supermanbin</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/07/JavaScript的实例化与继承：请停止使用new关键字/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fengbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="supermanbin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">JavaScript的实例化与继承：请停止使用new关键字</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-07T15:35:54+08:00">
                2018-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>JavaScript中的new关键字可以实现实例化和继承的工作，但个人认为使用new关键字并非是最佳的实践，还可以有更友好一些的实现。本文将介绍使用new关键字有什么问题，然后介绍如何对与new相关联的一系列面向对象操作进行封装，以便提供更快捷的、更易让人理解的实现方式。<br><a id="more"></a></p>
<h2 id="传统的实例化与继承"><a href="#传统的实例化与继承" class="headerlink" title="传统的实例化与继承"></a>传统的实例化与继承</h2><p>假设我们有两个类,<code>Class:function Class() {}</code> and <code>SubClass:function SubClass(){}</code>，SubClass需要继承自Class。传统方法一般是按如下步骤来组织和实现的：</p>
<ul>
<li>Class中<strong>被继承的属性和方法</strong>必须放在Class的prototype属性中</li>
<li>SubClass中<strong>自己的方法和属性</strong>也必须放在自己prototype属性中</li>
<li>SubClass的prototype对象的prototype(<strong>proto</strong>)属性必须指向的Class的prototype</li>
</ul>
<p>这样一来，由于prototype链的特性，SubClass的实例便能追溯到Class的方法，从而实现继承：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> SubClass()      <span class="built_in">Object</span>.create(Class.prototype)</div><div class="line">    |                    |</div><div class="line">    V                    V</div><div class="line">SubClass.prototype ---&gt; &#123; &#125;</div><div class="line">                        &#123; &#125;.__proto__ ---&gt; Class.prototype</div></pre></td></tr></table></figure></p>
<p>举一个具体的例子：下面的代码中，我们做了以下几件事:</p>
<ul>
<li>定义一个父类叫做Human</li>
<li>定义一个名为Man的子类继承自Human</li>
<li>子类继承父类的一切属性，并调用父类的构造函数，实例化这个子类<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">/ 构造函数/基类</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Human</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* </span></div><div class="line">    基类的方法保存在构造函数的prototype属性中</div><div class="line">    便于子类的继承</div><div class="line">*/</div><div class="line">Human.prototype.say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"say"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">    道格拉斯的object方法（等同于object.create方法）</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">o</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    F.prototype = o;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> F();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 子类构造函数</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Man</span>(<span class="params">name, age</span>) </span>&#123;</div><div class="line">    <span class="comment">// 调用父类的构造函数</span></div><div class="line">    Human.call(<span class="keyword">this</span>, name);</div><div class="line">    <span class="comment">// 自己的属性age</span></div><div class="line">    <span class="keyword">this</span>.age = age;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 继承父类的方法</span></div><div class="line">Man.prototype = object(Human.prototype);</div><div class="line">Man.prototype.constructor = Man;</div><div class="line"></div><div class="line"><span class="comment">// 实例化子类</span></div><div class="line"><span class="keyword">var</span> man = <span class="keyword">new</span> Man(<span class="string">"Lee"</span>, <span class="number">22</span>);</div><div class="line"><span class="built_in">console</span>.log(man);</div><div class="line"><span class="comment">// 调用父类的say方法：</span></div><div class="line">man.say();</div></pre></td></tr></table></figure>
</li>
</ul>
<p>通过上面的代码可以总结出传统的实例化与继承的几个特点：</p>
<ul>
<li>传统方法中的“类”一定是一个构造函数。</li>
<li>属性和方法绑定在prototype属性上，并借助prototype的特性实现继承。</li>
<li>通过new关键字来实例化一个对象。</li>
</ul>
<p>为什么我会十分的肯定Object.create方法与道格拉斯的object方法是一致呢？因为在MDN上，object方法就是作为Object.create的一个Polyfill方案：</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create" target="_blank" rel="external">Object.create</a></li>
<li><a href="http://javascript.crockford.com/prototypal.html" target="_blank" rel="external">Douglas Crockford’s object method</a></li>
</ul>
<h2 id="new关键字的不足之处"><a href="#new关键字的不足之处" class="headerlink" title="new关键字的不足之处"></a>new关键字的不足之处</h2><p>在《Javascript语言精粹》（Javascript: The Good Parts）中，道格拉斯认为应该避免使用new关键字：</p>
<blockquote>
<p>If you forget to include the new prefix when calling a constructor function, then this will not be bound to the new object. Sadly, this will be bound to the global object, so instead of augmenting your new object, you will be clobbering global variables. That is really bad. There is no compile warning, and there is no runtime warning. (page 49)</p>
</blockquote>
<p>大意是说在应该使用new的时候如果忘了new关键字，会引发一些问题。</p>
<p>当然了，你遗忘使用任何关键字都会引起一系列的问题。再退一步说，这个问题是<a href="http://stackoverflow.com/questions/383402/is-javascript-s-new-keyword-considered-harmful#answer-383503" target="_blank" rel="external">完全可以避免的</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span></div><div class="line">&#123;   </div><div class="line">   <span class="comment">// 如果忘了使用关键字，这一步骤会悄悄帮你修复这个问题</span></div><div class="line">   <span class="keyword">if</span> ( !(<span class="keyword">this</span> <span class="keyword">instanceof</span> foo) )</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> foo();</div><div class="line"></div><div class="line">   <span class="comment">// 构造函数的逻辑继续……</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>或者更通用的抛出异常即可<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ( !(<span class="keyword">this</span> <span class="keyword">instanceof</span> <span class="built_in">arguments</span>.callee) ) </div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Constructor called as a function"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>又或者按照<a href="http://ejohn.org/blog/simple-class-instantiation/" target="_blank" rel="external">John Resig的方案</a>，准备一个makeClass工厂函数，把大部分的初始化功能放在一个init方法中，而非构造函数自己中：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// makeClass - By John Resig (MIT Licensed)</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeClass</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span> ( <span class="keyword">this</span> <span class="keyword">instanceof</span> <span class="built_in">arguments</span>.callee ) &#123;</div><div class="line">      <span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="keyword">this</span>.init == <span class="string">"function"</span> )</div><div class="line">        <span class="keyword">this</span>.init.apply( <span class="keyword">this</span>, args.callee ? args : <span class="built_in">arguments</span> );</div><div class="line">    &#125; <span class="keyword">else</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">arguments</span>.callee( <span class="built_in">arguments</span> );</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在我看来，new关键字不是一个好的实践的关键原因是：</p>
<blockquote>
<p><a href="http://dailyjs.com/2010/05/24/history-of-javascript-1/" target="_blank" rel="external">…new is a remnant of the days where JavaScript accepted a Java like syntax for gaining “popularity”. And we were pushing it as a little brother to Java, as a complementary language like Visual Basic was to C++ in Microsoft’s language families at the time.</a></p>
</blockquote>
<p>道格拉斯将这个问题描述为</p>
<blockquote>
<p><a href="http://javascript.crockford.com/prototypal.html" target="_blank" rel="external">This indirection was intended to make the language seem more familiar to classically trained programmers, but failed to do that, as we can see from the very low opinion Java programmers have of JavaScript. JavaScript’s constructor pattern did not appeal to the classical crowd. It also obscured JavaScript’s true prototypal nature. As a result, there are very few programmers who know how to use the language effectively.</a></p>
</blockquote>
<p>简单来说，JavaScript是一种prototypical类型语言，在创建之初，是为了迎合市场的需要，让人们觉得它和Java是类似的，才引入了new关键字。Javascript本应通过它的Prototypical特性来实现实例化和继承，但new关键字让它变得不伦不类。</p>
<h2 id="把传统方法加以改造"><a href="#把传统方法加以改造" class="headerlink" title="把传统方法加以改造"></a>把传统方法加以改造</h2><p>既然new关键字不够友好，那么我们有两个办法可以解决这个问题：一是完全抛弃new关键字，二是把含有new关键字的操作封装起来，只向外提供友好的接口。下面将介绍第二种方法的实现思路，把传统方法加以改造。</p>
<p>我们开始构造一个最原始的基类Class（类似于JavaScript中的Object类），并且只向外提供两个接口：</p>
<ul>
<li>Class.extend 用于拓展子类</li>
<li>Class.create 用于创建实例</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 基类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Class</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="comment">// 将extend和create置于prototype对象中，以便子类继承</span></div><div class="line">Class.prototype.extend = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">Class.prototype.create = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 为了能在基类上直接以.extend的方式进行调用</span></div><div class="line">Class.extend = <span class="function"><span class="keyword">function</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.prototype.extend.call(<span class="keyword">this</span>, props);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>extend和create的具体实现：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">Class.prototype.create = <span class="function"><span class="keyword">function</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">        create实际上是对new的封装；</div><div class="line">        create返回的实例实际上就是new构造出的实例；</div><div class="line">        this即指向调用当前create的构造函数；</div><div class="line">    */</div><div class="line">    <span class="keyword">var</span> instance = <span class="keyword">new</span> <span class="keyword">this</span>();</div><div class="line">    <span class="comment">/*</span></div><div class="line">        绑定该实例的属性</div><div class="line">    */</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> props) &#123;</div><div class="line">        instance[name] = props[name];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Class.prototype.extend = <span class="function"><span class="keyword">function</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">        派生出来的新的子类</div><div class="line">    */</div><div class="line">    <span class="keyword">var</span> SubClass = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    <span class="comment">/*</span></div><div class="line">        继承父类的属性和方法，</div><div class="line">        当然前提是父类的属性都放在prototype中</div><div class="line">        而非上面create方法的“实例属性”中</div><div class="line">    */</div><div class="line">    SubClass.prototype = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.prototype);</div><div class="line">    <span class="comment">// 并且添加自己的方法和属性</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> props) &#123;</div><div class="line">        SubClass.prototype[name] = props[name];</div><div class="line">    &#125;</div><div class="line">    SubClass.prototype.constructor = SubClass;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line">        介于需要以.extend的方式和.create的方式调用：</div><div class="line">    */</div><div class="line">    SubClass.extend = SubClass.prototype.extend;</div><div class="line">    SubClass.create = SubClass.prototype.create;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> SubClass;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>仍然以Human和Man类举例使用说明：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Human = Class.extend(&#123;</div><div class="line">    <span class="attr">say</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Hello"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> human = Human.create();</div><div class="line"><span class="built_in">console</span>.log(human)</div><div class="line">human.say();</div><div class="line"></div><div class="line"><span class="keyword">var</span> Man = Human.extend(&#123;</div><div class="line">    <span class="attr">walk</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"walk"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> man = Man.create(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">"Lee"</span>,</div><div class="line">    <span class="attr">age</span>: <span class="number">22</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(man);</div><div class="line"><span class="comment">// 调用父类方法</span></div><div class="line">man.say();</div><div class="line"></div><div class="line">man.walk();</div></pre></td></tr></table></figure></p>
<p>至此，基本框架已经搭建起来，接下来继续补充功能。</p>
<ul>
<li>我们希望把构造函数独立出来，并且统一命名为init。就好像Backbone.js中每一个view都有一个initialize方法一样。这样能让初始化更灵活和标准化，甚至可以把init构造函数借出去</li>
<li>我还想新增一个子类方法调用父类同名方法的机制，比如说在父类和子类的中都定义了一个say方法，那么只要在子类的say中调用this.callSuper()就能调用父类的say方法了。例如：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 基类</span></div><div class="line"><span class="keyword">var</span> Human = Class.extend(&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">        你需要在定义类时定义构造方法init</div><div class="line">    */</div><div class="line">    init: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.nature = <span class="string">"Human"</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">say</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"I am a human"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Man = Human.extend(&#123;</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.sex = <span class="string">"man"</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">say</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// 调用同名的父类方法</span></div><div class="line">        <span class="keyword">this</span>.callSuper();</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"I am a man"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>那么Class.create就不仅仅是new一个构造函数了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Class.create = Class.prototype.create = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">        注意在这里我们只是实例化一个构造函数</div><div class="line">        而非最后返回的“实例”，</div><div class="line">        可以理解这个实例目前只是一个“壳”</div><div class="line">        需要init函数对这个“壳”填充属性和方法</div><div class="line">    */</div><div class="line">    <span class="keyword">var</span> instance = <span class="keyword">new</span> <span class="keyword">this</span>();</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line">        如果对init有定义的话</div><div class="line">    */</div><div class="line">    <span class="keyword">if</span> (instance.init) &#123;</div><div class="line">        instance.init.apply(instance, <span class="built_in">arguments</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实现在子类方法调用父类同名方法的机制，我们可以借用<a href="http://ejohn.org/blog/simple-javascript-inheritance/" target="_blank" rel="external">John Resig的方案</a>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">Class.extend = Class.prototype.extend = <span class="function"><span class="keyword">function</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> SubClass = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    <span class="keyword">var</span> _super = <span class="keyword">this</span>.prototype;</div><div class="line">     SubClass.prototype = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.prototype);</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> props) &#123;</div><div class="line">        <span class="comment">// 如果父类同名属性也是一个函数</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> props[name] == <span class="string">"function"</span> </div><div class="line">            &amp;&amp; <span class="keyword">typeof</span> _super[name] == <span class="string">"function"</span>) &#123;</div><div class="line">            <span class="comment">// 重新定义用户的同名函数，把用户的函数包装起来</span></div><div class="line">            SubClass.prototype[name] </div><div class="line">                = (<span class="function"><span class="keyword">function</span> (<span class="params">super_fn, fn</span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">                    <span class="comment">// 如果用户有自定义callSuper的话，暂存起来</span></div><div class="line">                    <span class="keyword">var</span> tmp = <span class="keyword">this</span>.callSuper;</div><div class="line">                    <span class="comment">// callSuper即指向同名父类函数</span></div><div class="line">                    <span class="keyword">this</span>.callSuper = super_fn;</div><div class="line">                    <span class="comment">/*</span></div><div class="line">                        callSuper即存在子类同名函数的上下文中</div><div class="line">                        以this.callSuper()形式调用</div><div class="line">                    */</div><div class="line">                    <span class="keyword">var</span> ret = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">                    <span class="keyword">this</span>.callSuper = tmp;</div><div class="line"></div><div class="line">                    <span class="comment">/*</span></div><div class="line">                        如果用户没有自定义的callsuper方法，则delete</div><div class="line">                    */</div><div class="line">                    <span class="keyword">if</span> (!<span class="keyword">this</span>.callSuper) &#123;</div><div class="line">                        <span class="keyword">delete</span> <span class="keyword">this</span>.callSuper;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="keyword">return</span> ret;</div><div class="line">                &#125;</div><div class="line">            &#125;)(_super[name], props[name])  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 如果是非同名属性或者方法</span></div><div class="line">            SubClass.prototype[name] = props[name];    </div><div class="line">        &#125;</div><div class="line"></div><div class="line">        ..</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    SubClass.prototype.constructor = SubClass; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后给出一个完整版，并且做了一些优化：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Class</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line">Class.extend = <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">props</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> prototype = <span class="keyword">new</span> <span class="keyword">this</span>();</div><div class="line">    <span class="keyword">var</span> _super = <span class="keyword">this</span>.prototype;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> props) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> props[name] == <span class="string">"function"</span> </div><div class="line">            &amp;&amp; <span class="keyword">typeof</span> _super[name] == <span class="string">"function"</span>) &#123;</div><div class="line"></div><div class="line">            prototype[name] = (<span class="function"><span class="keyword">function</span> (<span class="params">super_fn, fn</span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> tmp = <span class="keyword">this</span>.callSuper;</div><div class="line"></div><div class="line">                    <span class="keyword">this</span>.callSuper = super_fn;</div><div class="line"></div><div class="line">                    <span class="keyword">var</span> ret = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line"></div><div class="line">                    <span class="keyword">this</span>.callSuper = tmp;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (!<span class="keyword">this</span>.callSuper) &#123;</div><div class="line">                        <span class="keyword">delete</span> <span class="keyword">this</span>.callSuper;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> ret;</div><div class="line">                &#125;</div><div class="line">            &#125;)(_super[name], props[name])</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            prototype[name] = props[name];    </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Class</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line">    Class.prototype = prototype;</div><div class="line">    Class.prototype.constructor = Class;</div><div class="line"></div><div class="line">    Class.extend =  extend;</div><div class="line">    Class.create = Class.prototype.create = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> instance = <span class="keyword">new</span> <span class="keyword">this</span>();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (instance.init) &#123;</div><div class="line">            instance.init.apply(instance, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> Class;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下面是测试的代码。为了验证上面代码的健壮性，故意实现了三层继承：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Human = Class.extend(&#123;</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.nature = <span class="string">"Human"</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">say</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"I am a human"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> human = Human.create();</div><div class="line"><span class="built_in">console</span>.log(human);</div><div class="line">human.say();</div><div class="line"></div><div class="line"><span class="keyword">var</span> Man = Human.extend(&#123;</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.callSuper();</div><div class="line">        <span class="keyword">this</span>.sex = <span class="string">"man"</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">say</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.callSuper();</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"I am a man"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> man = Man.create();</div><div class="line"><span class="built_in">console</span>.log(man);</div><div class="line">man.say();</div><div class="line"></div><div class="line"><span class="keyword">var</span> Person = Man.extend(&#123;</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.callSuper();</div><div class="line">        <span class="keyword">this</span>.name = <span class="string">"lee"</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">say</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.callSuper();</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"I am Lee"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> person = Person.create();</div><div class="line"><span class="built_in">console</span>.log(person);</div><div class="line">person.say();</div></pre></td></tr></table></figure></p>
<h3 id="是时候彻底抛弃new关键字了"><a href="#是时候彻底抛弃new关键字了" class="headerlink" title="是时候彻底抛弃new关键字了"></a>是时候彻底抛弃new关键字了</h3><p>如果不使用new关键字，那么我们需要转投上两节中反复使用的Object.create来生产新的对象假设我们有一个矩形对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Rectangle = &#123;</div><div class="line">    <span class="attr">area</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.width * <span class="keyword">this</span>.height);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>借助Object.create，我们可以生成一个拥有它所有方法的对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> rectangle = <span class="built_in">Object</span>.create(Rectangle);</div></pre></td></tr></table></figure>
<p>生成之后，我们还可以给这个实例赋值长宽，并且取得面积值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> rect = <span class="built_in">Object</span>.create(Rectangle);</div><div class="line">rect.width = <span class="number">5</span>;</div><div class="line">rect.height = <span class="number">9</span>;</div><div class="line">rect.area();</div></pre></td></tr></table></figure>
<p>注意这个过程我们没有使用new关键字，但是我们相当于实例化了一个对象(rectangle)，给这个对象加上了自己的属性，并且成功调用了类(Rectangle)的方法。</p>
<p>但是我们希望能自动化赋值长宽，没问题，那就定义一个create方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Rectangle = &#123;</div><div class="line">    <span class="attr">create</span>: <span class="function"><span class="keyword">function</span> (<span class="params">width, height</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> self = <span class="built_in">Object</span>.create(<span class="keyword">this</span>);</div><div class="line">      self.width = width;</div><div class="line">      self.height = height;</div><div class="line">      <span class="keyword">return</span> self;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">area</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.width * <span class="keyword">this</span>.height);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> rect = Rectangle.create(<span class="number">5</span>, <span class="number">9</span>);</div><div class="line">rect.area();</div></pre></td></tr></table></figure>
<p>在纯粹使用Object.create的机制下，我们已经完全抛弃了构造函数这个概念。一切都是对象，一个类也可以是对象，这个类的实例不过是一个它自己的复制品。</p>
<p>下面看看如何实现继承。我们现在需要一个正方形，继承自这个长方形</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Square = <span class="built_in">Object</span>.create(Rectangle);</div><div class="line"></div><div class="line">Square.create = <span class="function"><span class="keyword">function</span> (<span class="params">side</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> Rectangle.create.call(<span class="keyword">this</span>, side, side);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实例化它:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sq = Square.create(<span class="number">5</span>);</div><div class="line">sq.area();</div></pre></td></tr></table></figure>
<p>这种做法其实和我们第一种最基本的类似<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Man</span>(<span class="params">name, age</span>) </span>&#123;</div><div class="line">    Human.call(<span class="keyword">this</span>, name);</div><div class="line">    <span class="keyword">this</span>.age = age;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面的方法还是太复杂了，我们希望进一步自动化，于是我们可以写这么一个extend函数<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">extension</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> hasOwnProperty = <span class="built_in">Object</span>.hasOwnProperty;</div><div class="line">    <span class="keyword">var</span> object = <span class="built_in">Object</span>.create(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> property <span class="keyword">in</span> extension) &#123;</div><div class="line">      <span class="keyword">if</span> (hasOwnProperty.call(extension, property) ||</div><div class="line">        <span class="keyword">typeof</span> object[property] === <span class="string">"undefined"</span>) &#123;</div><div class="line">        object[property] = extension[property];</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> object;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">    其实上面这个方法可以直接绑定在原生的Object对象上：Object.prototype.extend</div><div class="line">    但个人不推荐这种做法</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="keyword">var</span> Rectangle = &#123;</div><div class="line">    <span class="attr">extend</span>: extend,</div><div class="line">    <span class="attr">create</span>: <span class="function"><span class="keyword">function</span> (<span class="params">width, height</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> self = <span class="built_in">Object</span>.create(<span class="keyword">this</span>);</div><div class="line">      self.width = width;</div><div class="line">      self.height = height;</div><div class="line">      <span class="keyword">return</span> self;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">area</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.width * <span class="keyword">this</span>.height);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>这样当我们需要继承时，就可以像前几个方法一样用了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Square = Rectangle.extend(&#123;</div><div class="line">    <span class="comment">// 重写实例化方法</span></div><div class="line">    create: <span class="function"><span class="keyword">function</span> (<span class="params">side</span>) </span>&#123;</div><div class="line">         <span class="keyword">return</span> Rectangle.create.call(<span class="keyword">this</span>, side, side);</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> s = Square.create(<span class="number">5</span>);</div><div class="line">s.area();</div></pre></td></tr></table></figure></p>
<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><p>本文对去new关键字的方法做了一些罗列，但工作还远远没有结束，有非常多的地方值得拓展，比如：如何重新定义instance of方法，用于判断一个对象是否是一个类的实例？如何在去new关键字的基础上继续实现多继承？希望本文的内容在这里只是抛砖引玉，能够开拓大家的思路。</p>
<h3 id="引用资料"><a href="#引用资料" class="headerlink" title="引用资料"></a>引用资料</h3><ul>
<li><a href="http://aaditmshah.github.io/why-prototypal-inheritance-matters/" target="_blank" rel="external">Why Prototypal Inheritance Matters</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create" target="_blank" rel="external">Object.create</a></li>
<li><a href="http://www.bennadel.com/blog/2184-Object-create-Improves-Constructor-Based-Inheritance-In-Javascript-It-Doesn-t-Replace-It.htm" target="_blank" rel="external">Object.create() Improves Constructor-Based Inheritance In Javascript - It Doesn’t Replace It</a></li>
<li><a href="http://dailyjs.com/2012/06/04/js101-object-create/" target="_blank" rel="external">JS101: Object.create</a></li>
<li><a href="http://ejohn.org/blog/simple-class-instantiation/" target="_blank" rel="external">Simple “Class” Instantiation</a></li>
<li><a href="http://stackoverflow.com/questions/4166616/understanding-the-difference-between-object-create-and-new-somefunction-in-j" target="_blank" rel="external">Understanding the difference between Object.create() and new SomeFunction() in JavaScript</a></li>
<li><a href="http://stackoverflow.com/questions/12592913/what-is-the-reason-to-use-the-new-keyword-here" target="_blank" rel="external">What is the reason to use the ‘new’ keyword here?</a></li>
<li><a href="http://stackoverflow.com/questions/13040684/javascript-inheritance-object-create-vs-new" target="_blank" rel="external">JavaScript inheritance: Object.create vs new</a></li>
<li><a href="http://stackoverflow.com/questions/383402/is-javascript-s-new-keyword-considered-harmful" target="_blank" rel="external">Is JavaScript ‘s “new” Keyword Considered Harmful?</a></li>
<li></li>
</ul>
<h3 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a><a href="http://www.infoq.com/cn/articles/javascript-instantiation-and-inheritance/#" target="_blank" rel="external">原文地址</a></h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/javascript/" rel="tag"># javascript</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/16/javascript设计模式/" rel="next" title="javascript设计模式">
                <i class="fa fa-chevron-left"></i> javascript设计模式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/02/07/React-Component/" rel="prev" title="React.Component">
                React.Component <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">fengbin</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#传统的实例化与继承"><span class="nav-number">1.</span> <span class="nav-text">传统的实例化与继承</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#new关键字的不足之处"><span class="nav-number">2.</span> <span class="nav-text">new关键字的不足之处</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#把传统方法加以改造"><span class="nav-number">3.</span> <span class="nav-text">把传统方法加以改造</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#是时候彻底抛弃new关键字了"><span class="nav-number">3.1.</span> <span class="nav-text">是时候彻底抛弃new关键字了</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结束语"><span class="nav-number">3.2.</span> <span class="nav-text">结束语</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#引用资料"><span class="nav-number">3.3.</span> <span class="nav-text">引用资料</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原文地址"><span class="nav-number">3.4.</span> <span class="nav-text">原文地址</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fengbin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
